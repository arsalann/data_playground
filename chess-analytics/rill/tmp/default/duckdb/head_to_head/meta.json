{"name":"head_to_head","version":"1769953545587","created_version":"1769953545587","type":"VIEW","sql":"-- Head-to-Head Rivalries\n-- Track matchups between specific players\n\nWITH matchups AS (\n  SELECT\n    CASE WHEN white_username \u003c black_username \n      THEN white_username ELSE black_username END AS player_1,\n    CASE WHEN white_username \u003c black_username \n      THEN black_username ELSE white_username END AS player_2,\n    time_class,\n    CASE \n      WHEN white_username \u003c black_username AND white_result = 'win' THEN 'player_1_wins'\n      WHEN white_username \u003e black_username AND black_result = 'win' THEN 'player_1_wins'\n      WHEN white_username \u003c black_username AND black_result = 'win' THEN 'player_2_wins'\n      WHEN white_username \u003e black_username AND white_result = 'win' THEN 'player_2_wins'\n      ELSE 'draw'\n    END AS result,\n    end_time\n  FROM read_parquet('data/games_enriched.parquet')\n  WHERE white_username IS NOT NULL AND black_username IS NOT NULL\n)\n\nSELECT\n  player_1,\n  player_2,\n  player_1 || ' vs ' || player_2 AS matchup_name,\n  time_class,\n  COUNT(*) AS total_games,\n  SUM(CASE WHEN result = 'player_1_wins' THEN 1 ELSE 0 END) AS player_1_wins,\n  SUM(CASE WHEN result = 'player_2_wins' THEN 1 ELSE 0 END) AS player_2_wins,\n  SUM(CASE WHEN result = 'draw' THEN 1 ELSE 0 END) AS draws,\n  ROUND(100.0 * SUM(CASE WHEN result = 'player_1_wins' THEN 1 ELSE 0 END) / COUNT(*), 1) AS player_1_win_pct,\n  MIN(end_time) AS first_game,\n  MAX(end_time) AS last_game\nFROM matchups\nGROUP BY player_1, player_2, time_class\nHAVING COUNT(*) \u003e= 2\nORDER BY total_games DESC"}
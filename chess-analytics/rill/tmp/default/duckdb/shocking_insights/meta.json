{"name":"shocking_insights","version":"1769953545309","created_version":"1769953545309","type":"VIEW","sql":"-- Shocking Insights: The data that makes you question everything about chess\n-- Built from real patterns found in 136K+ games\n\nWITH gm_games AS (\n  SELECT \n    *,\n    CASE \n      WHEN white_username IN ('MagnusCarlsen', 'Hikaru', 'GothamChess', 'DanielNaroditsky') THEN white_username\n      ELSE black_username\n    END as gm_player,\n    CASE \n      WHEN white_username IN ('MagnusCarlsen', 'Hikaru', 'GothamChess', 'DanielNaroditsky') THEN white_rating\n      ELSE black_rating\n    END as gm_rating,\n    CASE \n      WHEN white_username NOT IN ('MagnusCarlsen', 'Hikaru', 'GothamChess', 'DanielNaroditsky') THEN white_username\n      ELSE black_username\n    END as opponent,\n    CASE \n      WHEN white_username NOT IN ('MagnusCarlsen', 'Hikaru', 'GothamChess', 'DanielNaroditsky') THEN white_rating\n      ELSE black_rating\n    END as opponent_rating,\n    CASE \n      WHEN winner IN ('MagnusCarlsen', 'Hikaru', 'GothamChess', 'DanielNaroditsky') THEN 'GM Won'\n      WHEN winner IS NULL THEN 'Draw'\n      ELSE 'GM Lost'\n    END as gm_outcome,\n    -- Time dimensions\n    EXTRACT(HOUR FROM end_time) as hour_utc,\n    CASE EXTRACT(DOW FROM end_time)\n      WHEN 0 THEN 'Sunday'\n      WHEN 1 THEN 'Monday'  \n      WHEN 2 THEN 'Tuesday'\n      WHEN 3 THEN 'Wednesday'\n      WHEN 4 THEN 'Thursday'\n      WHEN 5 THEN 'Friday'\n      WHEN 6 THEN 'Saturday'\n    END as day_of_week,\n    -- Loss type for GMs\n    CASE \n      WHEN white_username IN ('MagnusCarlsen', 'Hikaru', 'GothamChess', 'DanielNaroditsky') \n        AND white_result IN ('checkmated', 'resigned', 'timeout') THEN white_result\n      WHEN black_username IN ('MagnusCarlsen', 'Hikaru', 'GothamChess', 'DanielNaroditsky')\n        AND black_result IN ('checkmated', 'resigned', 'timeout') THEN black_result\n      ELSE NULL\n    END as gm_loss_type\n  FROM read_parquet('data/games_enriched.parquet')\n  WHERE white_username IN ('MagnusCarlsen', 'Hikaru', 'GothamChess', 'DanielNaroditsky')\n     OR black_username IN ('MagnusCarlsen', 'Hikaru', 'GothamChess', 'DanielNaroditsky')\n)\n\nSELECT \n  *,\n  -- Is this an upset? Opponent 300+ rating below GM wins\n  CASE WHEN gm_outcome = 'GM Lost' AND (gm_rating - opponent_rating) \u003e 300 THEN TRUE ELSE FALSE END as is_giant_kill,\n  gm_rating - opponent_rating as rating_advantage,\n  -- Rating gap buckets\n  CASE \n    WHEN gm_rating - opponent_rating \u003e 1500 THEN '1500+ (Streamer Bait)'\n    WHEN gm_rating - opponent_rating \u003e 1000 THEN '1000-1500 (Massive)'\n    WHEN gm_rating - opponent_rating \u003e 500 THEN '500-1000 (Large)'\n    WHEN gm_rating - opponent_rating \u003e 200 THEN '200-500 (Moderate)'\n    ELSE '\u003c200 (Competitive)'\n  END as skill_gap_bucket,\n  -- Time period\n  CASE \n    WHEN hour_utc BETWEEN 6 AND 11 THEN 'Morning (6-11 UTC)'\n    WHEN hour_utc BETWEEN 12 AND 17 THEN 'Afternoon (12-17 UTC)'\n    WHEN hour_utc BETWEEN 18 AND 23 THEN 'Evening (18-23 UTC)'\n    ELSE 'Late Night (0-5 UTC)'\n  END as time_of_day\nFROM gm_games"}